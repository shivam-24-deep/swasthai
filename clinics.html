<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nearby Clinics - SwasthAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f0f9ff;
    }

    header {
      background-color: #008080;
      color: white;
      padding: 25px;
      text-align: center;
      border-bottom-left-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    #map {
      height: 80vh;
      width: 100%;
    }

    #search-container {
      text-align: center;
      margin: 10px;
    }

    #search {
      width: 80%;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    footer {
      background: #222;
      color: #aaa;
      text-align: center;
      padding: 15px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<header>
  <h1>Nearby Clinics</h1>
  <p>Auto-search hospitals, clinics & medicals near you</p>
</header>

<div id="search-container">
  <input id="search" type="text" placeholder="Search doctor, clinic, hospital..." />
</div>

<div id="map"></div>

<footer>
  <p>&copy; 2025 SwasthAI | Built with ‚ù§Ô∏è by You</p>
</footer>

<script>
  let map;
  let service;
  let infowindow;
  let markers = [];
  let userMarker;
  let userLocation;

  function initMap() {
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(position => {
        userLocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        if (!map) {
          map = new google.maps.Map(document.getElementById("map"), {
            center: userLocation,
            zoom: 14
          });

          infowindow = new google.maps.InfoWindow();

          userMarker = new google.maps.Marker({
            map,
            position: userLocation,
            title: "You are here",
            icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
          });

          // üîç Auto-load nearby places on page load
          searchNearby(userLocation, "clinic hospital pharmacy");
        } else {
          userMarker.setPosition(userLocation);
          map.setCenter(userLocation);
        }

        // üîç Manual search on input
        document.getElementById("search").addEventListener("input", (e) => {
          const keyword = e.target.value.trim();
          if (keyword.length > 2) {
            searchNearby(userLocation, keyword);
          }
        });

      }, () => {
        alert("Location access denied.");
      });
    } else {
      alert("Geolocation not supported.");
    }
  }

  function searchNearby(location, keyword) {
    markers.forEach(marker => marker.setMap(null));
    markers = [];

    const request = {
      location,
      radius: 5000,
      keyword
    };

    service = new google.maps.places.PlacesService(map);
    service.nearbySearch(request, (results, status) => {
      if (status === google.maps.places.PlacesServiceStatus.OK) {
        results.forEach(place => {
          const marker = new google.maps.Marker({
            map,
            position: place.geometry.location,
            title: place.name
          });

          markers.push(marker);

          google.maps.event.addListener(marker, "click", () => {
            const name = `<strong>${place.name}</strong>`;
            const address = place.vicinity || "No address available";
            const rating = place.rating ? `‚≠ê ${place.rating}` : "No rating";
            const openNow = place.opening_hours ? (place.opening_hours.open_now ? "Open Now" : "Closed Now") : "Hours not available";

            infowindow.setContent(`${name}<br>${address}<br>${rating}<br>${openNow}`);
            infowindow.open(map, marker);
          });
        });
      }
    });
  }
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQlJvbdO-nJov7fEr3cY9LZzRJKcf6-kI&libraries=places&callback=initMap">
</script>

</body>
</html>
